<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PetMarket - Нове оголошення</title>
    <link rel="icon" href="1/favicon.png" type="image/png">
    
    <script>
        (function() {
            if (localStorage.getItem('theme') === 'dark') {
                document.documentElement.classList.add('dark-theme');
            }
        })();
    </script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Comfortaa:wght@300;400;700&display=swap" rel="stylesheet">
    
    <script src="local-database.js"></script>
    <script src="theme.js"></script>
    <script src="auth.js"></script>

    <style>
        :root { 
            --bg-page: #F4EAF1; --bg-element: #F4FAF1; --purple-light: #C9C3DE; 
            --purple-medium: #B9B1CD; --purple-accent: #B6A8CA; --purple-dark: #8E83A9; 
            --container-width: 1230px; --text-color: #8E83A9; 
            --footer-bg: #8E83A9; --footer-text: #F4FAF1; 
        }
        
        html.dark-theme, body.dark-theme, html.dark-theme body { 
            --bg-page: #2E2B36; --bg-element: #3F3D4B; --purple-light: #4A4758; 
            --purple-medium: #5D5A6E; --purple-accent: #8E83A9; --purple-dark: #F4EAF1; 
            --text-color: #F4EAF1; --footer-bg: #1F1D24; --footer-text: #C9C3DE; 
        }
        
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: 'Comfortaa', sans-serif; background-color: var(--bg-page); color: var(--text-color); margin: 0; display: flex; flex-direction: column; min-height: 100vh; transition: color 0.3s; }
        a { text-decoration: none; color: inherit; }
        button { border: none; cursor: pointer; font-family: 'Comfortaa'; }
        .container { width: 100%; max-width: var(--container-width); margin: 0 auto; padding: 0 15px; }
        
        /* HEADER */
        .header-wrapper { width: 100%; background: var(--bg-page); box-shadow: 0 2px 0 0 #B9B1CD; position: sticky; top: 0; z-index: 100; transition: background-color 0.3s; }
        .header { display: flex; justify-content: space-between; align-items: center; height: 90px; }
        .header-left { display: flex; gap: 40px; }
        .logo { font-weight: 700; font-size: 24px; color: var(--text-color); }
        .nav-menu { display: flex; gap: 30px; }
        .nav-link { font-weight: 700; }
        .header-icons { display: flex; gap: 15px; }
        .icon-btn { width: 40px; height: 40px; border-radius: 50%; background: var(--purple-light); display: flex; justify-content: center; align-items: center; }
        .icon-btn img { width: 20px; }
        .login-btn { padding: 8px 16px; background: var(--purple-light); border-radius: 20px; font-weight: 700; color: var(--text-color); }

        /* PAGE LAYOUT */
        .page-title { font-size: 28px; font-weight: 700; margin: 30px 0 40px; text-align: left; padding-left: 10px; }

        .create-ad-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 60px;
            margin-bottom: 60px;
        }

        @media (max-width: 900px) {
            .create-ad-grid { grid-template-columns: 1fr; gap: 30px; }
        }

        /* LEFT SIDE - DESCRIPTION */
        .left-column {
            display: flex;
            flex-direction: column;
        }
        
        .desc-label { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: var(--text-color); }
        
        .desc-area {
            width: 100%; 
            height: 100%;
            min-height: 400px;
            padding: 20px; 
            border-radius: 15px;
            border: 2px solid var(--purple-light);
            background: var(--bg-element); 
            color: var(--text-color);
            font-family: 'Comfortaa'; 
            font-size: 16px; 
            line-height: 1.5;
            resize: none; 
            outline: none;
            transition: border-color 0.3s;
        }
        .desc-area:focus { border-color: var(--purple-accent); }

        /* RIGHT SIDE - SPECS TABLE */
        .right-column {
            display: flex;
            flex-direction: column;
        }

        .specs-title { font-size: 24px; font-weight: 700; margin-bottom: 20px; color: var(--text-color); }

        .specs-table { display: flex; flex-direction: column; width: 100%; }

        .spec-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 0;
            border-top: 1px solid var(--purple-light);
            font-size: 16px;
        }
        .spec-row:last-child { border-bottom: 1px solid var(--purple-light); }

        .spec-label { font-weight: 700; color: var(--text-color); }
        .spec-input-container { display: flex; align-items: center; justify-content: flex-end; }

        /* INPUTS (Stealth Mode) */
        .table-input {
            width: 200px;
            padding: 5px 0;
            border: none;
            border-bottom: 1px dashed transparent;
            background: transparent;
            color: var(--text-color);
            font-family: 'Comfortaa';
            font-size: 16px;
            outline: none;
            text-align: right;
            transition: border-color 0.3s;
        }
        .table-input:hover { border-bottom-color: var(--purple-medium); }
        .table-input:focus { border-bottom: 1px solid var(--purple-accent); }
        .table-input::placeholder { color: var(--purple-light); }

        /* SELECT STYLING */
        select.table-input {
            cursor: pointer;
            direction: rtl;
            appearance: none;
        }

        /* TOGGLES */
        .toggle-group {
            display: flex;
            background: var(--purple-light);
            border-radius: 12px;
            padding: 2px;
            gap: 2px;
        }

        .toggle-option {
            padding: 4px 12px;
            border-radius: 10px;
            font-size: 12px;
            font-weight: 700;
            color: var(--text-color);
            cursor: pointer;
            transition: background 0.3s, color 0.3s;
            user-select: none;
        }

        .toggle-option.active {
            background: var(--bg-element);
            color: var(--purple-dark);
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        
        .hidden-check { display: none; }

        /* BOTTOM ACTIONS */
        .action-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 20px;
            margin-bottom: 50px;
            padding-right: 15px;
        }

        .btn-submit {
            padding: 12px 40px;
            background: var(--purple-accent);
            color: white;
            border-radius: 20px;
            font-weight: 700;
            font-size: 16px;
            transition: 0.3s;
        }
        .btn-submit:hover { opacity: 0.9; transform: translateY(-2px); }
        
        .btn-cancel {
            padding: 12px 40px;
            background: transparent;
            color: var(--text-color);
            border: 2px solid var(--purple-light);
            border-radius: 20px;
            font-weight: 700;
            font-size: 16px;
            transition: 0.3s;
        }
        .btn-cancel:hover { background: var(--bg-element); }

        .footer { background: var(--footer-bg); color: var(--footer-text); padding: 20px 0; margin-top: auto; }
        .footer-content { display: flex; justify-content: space-between; padding-bottom: 20px; }
        .social-icon img { width: 30px; }
        .footer-copyright { text-align: center; font-size: 14px; }
    </style>
</head>
<body>
    <div class="header-wrapper">
        <div class="container">
            <header class="header">
                <div class="header-left">
                    <div class="logo">PetMarket</div>
                    <nav class="nav-menu">
                        <a href="index.html" class="nav-link">Home</a>
                        <a href="blog.html" class="nav-link">Blog</a>
                    </nav>
                </div>
                <div class="header-icons">
                    <button class="icon-btn" id="theme-toggle"><img src="1/Moon1.png" id="theme-icon"></button>
                    <button class="icon-btn"><img src="1/Like1.png" style="width: 20px;"></button>
                    <button class="login-btn" id="loginBtn">Login</button>
                </div>
            </header>
        </div>
    </div>

    <div class="container">
        <h1 class="page-title">Створити оголошення</h1>

        <div class="create-ad-grid">
            <!-- LEFT COLUMN: DESCRIPTION -->
            <div class="left-column">
                <div class="desc-label">Опис</div>
                <textarea id="ad-desc" class="desc-area" placeholder="Напишіть детальний опис тут..."></textarea>
            </div>

            <!-- RIGHT COLUMN: SPECS TABLE -->
            <div class="right-column">
                <div class="specs-title">Деталі</div>
                <div class="specs-table">
                    
                    <!-- 1. Пол -->
                    <div class="spec-row">
                        <span class="spec-label">Стать (Gender)</span>
                        <div class="spec-input-container">
                            <div class="toggle-group" id="gender-group">
                                <div class="toggle-option active" onclick="setGender('Male', this)">Хлопчик</div>
                                <div class="toggle-option" onclick="setGender('Female', this)">Дівчинка</div>
                            </div>
                            <input type="hidden" id="ad-gender" value="Male">
                        </div>
                    </div>

                    <!-- 2. Вид -->
                    <div class="spec-row">
                        <span class="spec-label">Вид (Species)</span>
                        <div class="spec-input-container">
                            <select id="ad-species" class="table-input">
                                <option value="" disabled selected>Оберіть...</option>
                                <option value="Коти">Коти</option>
                                <option value="Собаки">Собаки</option>
                                <option value="Птахи">Птахи</option>
                                <option value="Гризуни">Гризуни</option>
                                <option value="Риби">Риби</option>
                                <option value="Рептилії">Рептилії</option>
                                <option value="Інше">Інше</option>
                            </select>
                        </div>
                    </div>

                    <!-- 3. Порода -->
                    <div class="spec-row">
                        <span class="spec-label">Порода (Breed)</span>
                        <div class="spec-input-container">
                            <input type="text" id="ad-breed" class="table-input" placeholder="Введіть...">
                        </div>
                    </div>

                    <!-- 4. Вік -->
                    <div class="spec-row">
                        <span class="spec-label">Вік (Age)</span>
                        <div class="spec-input-container">
                            <input type="text" id="ad-age" class="table-input" placeholder="Введіть...">
                        </div>
                    </div>

                    <!-- 5. Місто -->
                    <div class="spec-row">
                        <span class="spec-label">Місто (City)</span>
                        <div class="spec-input-container">
                            <input type="text" id="ad-city" class="table-input" placeholder="Введіть...">
                        </div>
                    </div>

                    <!-- 6. Колір -->
                    <div class="spec-row">
                        <span class="spec-label">Забарвлення (Coat color)</span>
                        <div class="spec-input-container">
                            <input type="text" id="ad-color" class="table-input" placeholder="Введіть...">
                        </div>
                    </div>

                    <!-- 7. Очі -->
                    <div class="spec-row">
                        <span class="spec-label">Колір очей (Eye color)</span>
                        <div class="spec-input-container">
                            <input type="text" id="ad-eye" class="table-input" placeholder="Введіть...">
                        </div>
                    </div>

                    <!-- 8. Vaccinated -->
                    <div class="spec-row">
                        <span class="spec-label">Vaccinated</span>
                        <div class="spec-input-container">
                            <div class="toggle-group">
                                <div class="toggle-option" onclick="setBool('ad-vac', true, this)">Yes</div>
                                <div class="toggle-option active" onclick="setBool('ad-vac', false, this)">No</div>
                            </div>
                            <input type="checkbox" id="ad-vac" class="hidden-check">
                        </div>
                    </div>

                    <!-- 9. Microchipped -->
                    <div class="spec-row">
                        <span class="spec-label">Microchipped</span>
                        <div class="spec-input-container">
                            <div class="toggle-group">
                                <div class="toggle-option" onclick="setBool('ad-chip', true, this)">Yes</div>
                                <div class="toggle-option active" onclick="setBool('ad-chip', false, this)">No</div>
                            </div>
                            <input type="checkbox" id="ad-chip" class="hidden-check">
                        </div>
                    </div>

                    <!-- 10. Neutered/Spayed -->
                    <div class="spec-row">
                        <span class="spec-label">Neutered/Spayed</span>
                        <div class="spec-input-container">
                            <div class="toggle-group">
                                <div class="toggle-option" onclick="setBool('ad-neu', true, this)">Yes</div>
                                <div class="toggle-option active" onclick="setBool('ad-neu', false, this)">No</div>
                            </div>
                            <input type="checkbox" id="ad-neu" class="hidden-check">
                        </div>
                    </div>

                    <!-- 11. Parasite Treated -->
                    <div class="spec-row">
                        <span class="spec-label">Parasite Treated</span>
                        <div class="spec-input-container">
                            <div class="toggle-group">
                                <div class="toggle-option" onclick="setBool('ad-par', true, this)">Yes</div>
                                <div class="toggle-option active" onclick="setBool('ad-par', false, this)">No</div>
                            </div>
                            <input type="checkbox" id="ad-par" class="hidden-check">
                        </div>
                    </div>

                    <!-- 12. Veterinary Passport -->
                    <div class="spec-row">
                        <span class="spec-label">Veterinary Passport</span>
                        <div class="spec-input-container">
                            <div class="toggle-group">
                                <div class="toggle-option" onclick="setBool('ad-pass', true, this)">Yes</div>
                                <div class="toggle-option active" onclick="setBool('ad-pass', false, this)">No</div>
                            </div>
                            <input type="checkbox" id="ad-pass" class="hidden-check">
                        </div>
                    </div>

                    <!-- 13. Ціна -->
                    <div class="spec-row">
                        <span class="spec-label">Ціна ($)</span>
                        <div class="spec-input-container">
                            <input type="number" id="ad-price" class="table-input" placeholder="0">
                        </div>
                    </div>

                </div>
            </div>
        </div>

        <div class="action-buttons">
            <button class="btn-cancel" onclick="window.location.href='profile.html'">Скасувати</button>
            <button class="btn-submit" onclick="submitAd()">Опублікувати</button>
        </div>
    </div>

    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo"><span>Logo</span></div>
                <div class="footer-contact"><span>Contact Us: </span><span>@gmail.com</span></div>
                <div class="footer-social">
                    <a href="#" class="social-icon"><img src="1/insta.png"></a>
                    <a href="#" class="social-icon"><img src="1/Face.png"></a>
                    <a href="#" class="social-icon"><img src="1/Tw.png"></a>
                </div>
            </div>
            <div class="footer-copyright"><p>Marketplace. All rights reserved.</p></div>
        </div>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            updateLoginButton();
        });

        function setGender(val, el) {
            document.getElementById('ad-gender').value = val;
            const parent = el.parentElement;
            parent.querySelectorAll('.toggle-option').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        function setBool(id, val, el) {
            document.getElementById(id).checked = val;
            const parent = el.parentElement;
            parent.querySelectorAll('.toggle-option').forEach(opt => opt.classList.remove('active'));
            el.classList.add('active');
        }

        function submitAd() {
            const user = window.LocalDB.getCurrentUser();
            if(!user) { alert("Будь ласка, увійдіть в акаунт."); return; }

            // Get values
            const gender = document.getElementById('ad-gender').value;
            const species = document.getElementById('ad-species').value;
            const breed = document.getElementById('ad-breed').value;
            const age = document.getElementById('ad-age').value;
            const city = document.getElementById('ad-city').value;
            const color = document.getElementById('ad-color').value;
            const eye = document.getElementById('ad-eye').value;
            const price = document.getElementById('ad-price').value;
            const desc = document.getElementById('ad-desc').value;

            // Strict Validation
            if (!species) { alert("Будь ласка, оберіть 'Вид тварини'"); return; }
            if (!breed) { alert("Будь ласка, введіть 'Породу'"); return; }
            if (!age) { alert("Будь ласка, введіть 'Вік'"); return; }
            if (!city) { alert("Будь ласка, введіть 'Місто'"); return; }
            if (!color) { alert("Будь ласка, введіть 'Забарвлення'"); return; }
            if (!eye) { alert("Будь ласка, введіть 'Колір очей'"); return; }
            if (!price) { alert("Будь ласка, введіть 'Ціну'"); return; }
            if (!desc) { alert("Будь ласка, заповніть 'Опис'"); return; }

            const newPet = {
                price: parseInt(price),
                age: age,
                gender: gender,
                color: color,
                eye_color: eye,
                city: city,
                description: desc,
                
                is_vaccinated: document.getElementById('ad-vac').checked,
                is_microchipped: document.getElementById('ad-chip').checked,
                is_neutered: document.getElementById('ad-neu').checked,
                is_parasite_treated: document.getElementById('ad-par').checked,
                has_vet_passport: document.getElementById('ad-pass').checked,
                
                // Custom handling
                is_custom: true,
                custom_breed_name: breed,
                custom_species: species,
                breed_id: 'custom'
            };

            window.LocalDB.addPet(newPet);
            alert("Оголошення успішно опубліковано!");
            window.location.href = 'profile.html';
        }
    </script>
</body>
</html>